---
title: Reflective Shadow Maps
date: 2024-07-8 15:20:20
tags: CG
categories: 论文复现
description: Reflective Shadow Maps理论
mathjax: true
---

# Reflective Shadow Maps
虽然直接翻译是反射阴影贴图，但是是用来解决间接光照问题的

## 虚拟点光源（VPL）
RSM的核心思想是把直接光源照亮的区域，又作为VPL继续计算
1. 单独计算直接光照对环境的影响
2. 获取直接光照亮的区域
    - 有个很简单的方法是，从光源视角进行一次渲染，得到照亮的区域，渲染之后保存位置，法线，颜色到纹理中，其实就是类似于SM的获取
3. 前面说过RSM的核心，这里就利用生成的纹理（也就是所有的VPL），通过公式计算间接光照
4. 把间接光和直接光结合（直接相加）

## 计算公式
<图片>
着色点x收到的某一个虚拟点光源$x_p$的辐射强度如下所示：
<div> $$E_p(x)=/frac{L(x_p)·max(n·(x_p-x),0)}{{||x-x_p||}^2}$$ </div>
原文公式：
<div> $$E_p(x,n)=/phi_p/frac{max(n_p·x-x_p,0)max(n·x_p-x,0)}{{||x-x_p||}^2}$$ </div>

如果把$L(x_p)$当做颜色，这就是一个点光源对着色点x的光源公式，最大的变数就是$L(x_p)$
- 如果直接光源是平行光（也就是太阳光，不会衰减）
<div> $$L(x_p)=c_pI$$ </div>
其中$c_p$就是为点$x_p$的颜色，I为平行光的光照强度


- 如果直接光源为点光源$v$
<div> $$L_p(x)=I/frac{max(n_p·(v-x_p),0)}{{||v-x_p||}^2}$$ </div>
原文公式：
其中$I$为点光源的光照强度。

VPL的方法就是先计算出VPL接受到的光照强度$L(x_p)$，然后再把这个VPL当成一个点光源来计算着色点的光照即可

## 改进

如果发光区域很大，那么VPL就很多，计算效率就很低
作者假设屏幕空间里面里这个着色点越近，对光源贡献就更大。因此多选取一点离着色点近的VPL，并且为了弥补越往外采样数越少可能会带来的问题，作者引入了权重，越近了权重越小，越远的权重越大。
<图片>

随着采样距离变大，采样密度在逐渐减小。采样公式（选取虚拟点光源）如下：
<div> $$(s+r_{max}ξ_1sin(2/piξ_2),t+r_{max}ξ_1+cos(2\piξ_2))$$ </div>

$(s,t)$ 是当前着色点的屏幕空间的坐标（UV坐标），我们可以通过生成多组（这个一组就代表多计算一次间接光照，有几个就相当于用多少个虚拟点光源），ξ1，ξ2为随机数（一组采样就需要一对随机数）代入上面的公式就可以得到一个采样坐标，然后再根据上面的光照计算公式来计算这个VPL对着色点的光照公式。注意：这种方法会有很大的误差，为了进行一些弥补，在每计算完一个虚拟点光源对着色点的光照之后应该再乘以权重$ξ_1^2$
